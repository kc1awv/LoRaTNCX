<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoRaTNCX - Web Interface</title>
    <!-- Bootstrap CSS -->
    <link href="a/css/bs.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <strong>LoRaTNCX</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#status">Status</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#lora">LoRa Config</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#wifi">WiFi Config</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#gnss">GNSS Config</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#system">System</a>
                    </li>
                </ul>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                    <label class="form-check-label text-light" for="autoRefresh">
                        Auto-refresh
                    </label>
                </div>
                <div class="form-check form-switch ms-3">
                    <input class="form-check-input" type="checkbox" id="darkMode">
                    <label class="form-check-label text-light" for="darkMode">
                        Dark Mode
                    </label>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Status Cards -->
        <div id="status" class="row mb-4">
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">Board</h6>
                        <p class="card-text mb-0 small" id="boardInfo">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">WiFi</h6>
                        <p class="card-text mb-0 small" id="wifiStatus">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">IP Address</h6>
                        <p class="card-text mb-0 small" id="ipAddress">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">GNSS</h6>
                        <p class="card-text mb-0 small" id="gnssStatus">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">Battery</h6>
                        <p class="card-text mb-0 small" id="batteryStatus">Loading...</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-6 mb-2">
                <div class="card h-100">
                    <div class="card-body text-center d-flex flex-column justify-content-center">
                        <h6 class="card-title mb-1">Uptime</h6>
                        <p class="card-text mb-0 small" id="uptime">Loading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- LoRa Configuration -->
        <div id="lora" class="card mb-4">
            <div class="card-header">
                <h4>LoRa Radio Configuration</h4>
            </div>
            <div class="card-body">
                <form id="loraForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="frequency" class="form-label">Frequency (MHz)</label>
                                <input type="number" class="form-control" id="frequency" step="0.1" min="150" max="960">
                                <div id="frequencyHelp" class="form-text">Valid range: 150 - 960 MHz</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="bandwidth" class="form-label">Bandwidth (kHz)</label>
                                <select class="form-select" id="bandwidth">
                                    <option value="7.8">7.8 kHz (Narrowest)</option>
                                    <option value="10.4">10.4 kHz</option>
                                    <option value="15.6">15.6 kHz</option>
                                    <option value="20.8">20.8 kHz</option>
                                    <option value="31.25">31.25 kHz</option>
                                    <option value="41.7">41.7 kHz</option>
                                    <option value="62.5">62.5 kHz</option>
                                    <option value="125">125 kHz</option>
                                    <option value="250">250 kHz</option>
                                    <option value="500">500 kHz (Widest)</option>
                                </select>
                                <div id="bandwidthHelp" class="form-text">More bandwidth allows for higher data rates but may reduce range.</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="spreadingFactor" class="form-label">Spreading Factor</label>
                                <select class="form-select" id="spreadingFactor">
                                    <option value="7">7 (Fastest)</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12 (Slowest)</option>
                                </select>
                                <div id="spreadingFactorHelp" class="form-text">Higher spreading factors increase range but reduce data rate.</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="codingRate" class="form-label">Coding Rate</label>
                                <select class="form-select" id="codingRate">
                                    <option value="5">4/5 (Fast)</option>
                                    <option value="6">4/6</option>
                                    <option value="7">4/7</option>
                                    <option value="8">4/8 (Robust)</option>
                                </select>
                                <div id="codingRateHelp" class="form-text">Higher coding rates improve robustness but reduce data rate.</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="power" class="form-label">TX Power (dBm)</label>
                                <input type="number" class="form-control" id="power" min="-9">
                                <div id="powerHelp" class="form-text">Loading board information...</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="syncWord" class="form-label">Sync Word (hex)</label>
                                <input type="text" class="form-control" id="syncWord" placeholder="0x12AB">
                                <div id="syncWordHelp" class="form-text">Valid range: 0x0000 - 0xFFFF</div>
                            </div>
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary" id="resetBtn">Reset to Defaults</button>
                        <button type="submit" class="btn btn-primary">Apply Configuration</button>
                        <button type="button" class="btn btn-success" id="saveBtn">Save to NVS</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- WiFi Configuration -->
        <div id="wifi" class="card mb-4">
            <div class="card-header">
                <h4>WiFi Configuration</h4>
            </div>
            <div class="card-body">
                <form id="wifiForm">
                    <div class="mb-3">
                        <label for="wifiMode" class="form-label">WiFi Mode</label>
                        <select class="form-select" id="wifiMode">
                            <option value="off">Disabled</option>
                            <option value="ap">Access Point</option>
                            <option value="sta">Station</option>
                            <option value="apsta">AP + Station</option>
                        </select>
                    </div>
                    <div id="staConfig" style="display: none;">
                        <div class="mb-3">
                            <label for="ssid" class="form-label">SSID</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="ssid">
                                <button class="btn btn-outline-secondary" type="button" id="scanBtn" style="display: none;">
                                    <i class="bi bi-wifi"></i> Scan
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password">
                        </div>
                    </div>
                    <div id="apConfig">
                        <div class="mb-3">
                            <label for="apSsid" class="form-label">AP SSID</label>
                            <input type="text" class="form-control" id="apSsid" placeholder="LoRaTNCX-XXXX">
                        </div>
                        <div class="mb-3">
                            <label for="apPassword" class="form-label">AP Password</label>
                            <input type="password" class="form-control" id="apPassword" placeholder="loratncx">
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" class="btn btn-primary">Apply WiFi Config</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- WiFi Scan Modal -->
        <div class="modal fade" id="wifiScanModal" tabindex="-1" aria-labelledby="wifiScanModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="wifiScanModalLabel">Scan WiFi Networks</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="scanStatus" class="text-center mb-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Scanning...</span>
                            </div>
                            <p class="mt-2">Scanning for WiFi networks...</p>
                        </div>
                        <div id="networkList" class="d-none">
                            <p class="mb-2">Select a network:</p>
                            <div class="list-group" id="networksContainer">
                                <!-- Networks will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GNSS Configuration -->
        <div id="gnss" class="card mb-4">
            <div class="card-header">
                <h4>GNSS Configuration</h4>
            </div>
            <div class="card-body">
                <form id="gnssForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="gnssEnabled">
                                    <label class="form-check-label" for="gnssEnabled">
                                        Enable GNSS
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="serialPassthrough">
                                    <label class="form-check-label" for="serialPassthrough">
                                        Serial Passthrough
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="gnssBaudRate" class="form-label">Baud Rate</label>
                                <select class="form-select" id="gnssBaudRate">
                                    <option value="9600">9600</option>
                                    <option value="19200">19200</option>
                                    <option value="38400">38400</option>
                                    <option value="57600">57600</option>
                                    <option value="115200">115200</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="gnssTcpPort" class="form-label">TCP Port</label>
                                <input type="number" class="form-control" id="gnssTcpPort" min="1" max="65535">
                            </div>
                        </div>
                    </div>
                    <div id="pinConfig" class="row" style="display: none;">
                        <div class="col-md-12">
                            <h6>Pin Configuration</h6>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="pinRX" class="form-label">RX Pin</label>
                                <input type="number" class="form-control" id="pinRX" min="0" max="39">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="pinTX" class="form-label">TX Pin</label>
                                <input type="number" class="form-control" id="pinTX" min="0" max="39">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="pinPPS" class="form-label">PPS Pin</label>
                                <input type="number" class="form-control" id="pinPPS" min="0" max="39">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="pinRST" class="form-label">RST Pin</label>
                                <input type="number" class="form-control" id="pinRST" min="0" max="39">
                            </div>
                        </div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary" id="resetGnssBtn">Reset to Defaults</button>
                        <button type="submit" class="btn btn-primary">Apply GNSS Config</button>
                        <button type="button" class="btn btn-success" id="saveGnssBtn">Save to NVS</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- System Information -->
        <div id="system" class="card">
            <div class="card-header">
                <h4>System Information</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Hardware</h5>
                        <p id="hardwareInfo">Loading...</p>
                        <h5>Memory</h5>
                        <p id="memoryInfo">Loading...</p>
                        <h5>Storage</h5>
                        <p id="storageInfo">Loading...</p>
                    </div>
                    <div class="col-md-6">
                        <h5>Current Configuration</h5>
                        <p id="currentConfig">Loading...</p>
                        <h5>Network Status</h5>
                        <p id="networkStatus">Loading...</p>
                        <h5>GNSS Status</h5>
                        <p id="gnssDetailStatus">Loading...</p>
                    </div>
                </div>
                <hr>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-warning" id="restartBtn">Restart Device</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="a/js/bs.js"></script>
    <!-- Custom JavaScript -->
    <script src="app.js"></script>
</body>
</html>